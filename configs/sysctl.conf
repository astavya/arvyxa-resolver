# Restricts kernel pointer exposure to unprivileged users, reducing info leaks in exploits.
kernel.kptr_restrict=2

# Limits console logging to errors/warnings, preventing info leaks via dmesg.
kernel.printk=3 3 3 3

# Disables unprivileged eBPF, blocking potential exploit vectors.
kernel.unprivileged_bpf_disabled=1

# Enables full BPF JIT hardening against ROP attacks.
net.core.bpf_jit_harden=2

# Prevents autoloading of TTY line disciplines, mitigating certain kernel vulns.
dev.tty.ldisc_autoload=0

# Disables unprivileged userfaultfd, preventing sandbox escapes.
vm.unprivileged_userfaultfd=0

# Disables kexec_load syscall, preventing unauthorized kernel swaps. Useful if your DNS setup doesn't use kexec.
kernel.kexec_load_disabled=1

# Disables Magic SysRq to avoid DoS/abuse.
kernel.sysrq=0

# Disables unprivileged user namespaces, a common exploit enabler.
kernel.unprivileged_userns_clone=0

# Enables SYN cookies to mitigate SYN floods. Critical for DNS over TCP (e.g: large responses).
net.ipv4.tcp_syncookies=1

# Protects against TCP time-wait issues.
net.ipv4.tcp_rfc1337=1

# Enables strict reverse path filtering to block spoofed packets. Essential anti-spoofing for public DNS.
net.ipv4.conf.all.rp_filter=1
net.ipv4.conf.default.rp_filter=1

# Disables ICMP redirects, preventing MiTM attacks.
net.ipv4.conf.all.accept_redirects=0
net.ipv4.conf.default.accept_redirects=0

# Disables secure redirects. Redundant if accepts are off, but harmless.
net.ipv4.conf.all.secure_redirects=0
net.ipv4.conf.default.secure_redirects=0
net.ipv6.conf.all.accept_redirects=0
net.ipv6.conf.default.accept_redirects=0

# Prevents sending redirects, avoiding info leaks.
net.ipv4.conf.all.send_redirects=0
net.ipv4.conf.default.send_redirects=0

# Disables ping responses and broadcast pings.
net.ipv4.icmp_echo_ignore_all=1
net.ipv4.icmp_echo_ignore_broadcasts = 1

# Disables IP source routing, blocking packet manipulation.
net.ipv4.conf.all.accept_source_route=0
net.ipv4.conf.default.accept_source_route=0
net.ipv6.conf.all.accept_source_route=0
net.ipv6.conf.default.accept_source_route=0

# Disables IPv6 router advertisements, preventing rogue router attacks.
net.ipv6.conf.all.accept_ra=0
net.ipv6.conf.default.accept_ra=0

# Disables ptrace debugging. Prevents process injection.
kernel.yama.ptrace_scope=3

# Increases ASLR randomness. Boosts exploit difficulty.
vm.mmap_rnd_bits=32
vm.mmap_rnd_compat_bits=16

# Prevents symlink and hardlink following in sticky dirs, blocking TOCTOU attacks
fs.protected_symlinks=1
fs.protected_hardlinks=1

# Strict protection for FIFOs
fs.protected_fifos=2
fs.protected_regular=2

# Restricts dmesg to root, preventing kernel log leaks.
kernel.dmesg_restrict=1

# Disables unprivileged perf events, blocking side-channel attacks.
kernel.perf_event_paranoid=3

# Disables IP forwarding if your DNS server isn't a router.
net.ipv4.ip_forward=0
net.ipv6.conf.all.forwarding=0

# Ignores bogus ICMP errors, anti-DoS.
net.ipv4.icmp_ignore_bogus_error_responses=1

# Fair Queue, improves network fairness and throughput efficiency.
net.core.default_qdisc=fq

# Switches to BBR for better congestion handling under load.
net.ipv4.tcp_congestion_control=bbr

# Reduces the number of SYN-ACK retries to 2. This helps mitigate SYN flood DoS attacks.
net.ipv4.tcp_synack_retries=2

# Lowers the tendency to swap from the default (usually 60) to 10, prioritizing RAM usage over disk swapping.
vm.swappiness = 10
